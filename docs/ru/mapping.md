## Общие правила описания объектного преобразования (mapping)
Все объекты данных должны быть помечены реализацией интерфейса-маркера (пустого интерфейса) *IDataObject*. Все объекты описывающие подчиненные запросы должны быть помечены реализацией интерфейса-маркера (пустого интерфейса) *ISqlObject*.

> Возможность описания преобразования для интерфейсов-маркеров позволяет не диктовать иерархию наследования объектов предметной области и одновременно (с помощью методов расширений (extension methods)) дать возможность удобной работы с этими объектами.

Правила объектного переобразования могут быть описаны статически с помощью аттрибутов классов в которые производится преобразование (см. [Статическое преобразование (static mapping)](./static.md)), или динамически с помощью описания преобразования в стиле LINQ выражения (см. [Динамическое преобразование (dynamic mapping)](./dynamic.md)).

###Свойства обычных типов
Свойства стандартных типов (string, bool, int...) в том числе поддерживающие пустое значение (int?, bool?), а так же свойства перечислимых типов (enum) оформляются как обычные свойства. Доступ к ним так же не отличается от типового. В зависисмости от 
[статического](./static.md#Описание-преобразования-свойств) и [динамического](./dynamic.md#Описание-преобразования-свойств) способа описания объектного преобразования разнится лишь способ описания их привязки к объектам БД.

###Свойства типа - бинарный объект
Для работы с большим бинарным объектом (BLOB) с использованием отложенного (lazy) связывания в XData предлагается использовать тип свойства *Lob*. Для этого типа определены следующие 

свойства:
	* byte[] *Value* - с помощью этого свойства можно получить и/или обновить значение бинарного объекта
	* (readonly) bool *Assigned* - проверяет значение бинарного объекта на значение NULL

методы:
	* *GetSize*() - возвращает размер бинарного объекта
	* (extension) Modify(Action<byte[]> action) - хелпер для удобства изменения значения бинарного объекта

операции: 
	* += - "синтаксический сахар", _data.SomeBlob += _someVariable идентично _data.SomeBlob.Value = _someVariable.
	
Например:
```csharp
newInvoice.Scan += _image;
...
if(newInvoice.Scan.Assigned) 
	_size = newInvoice.Scan.GetSize();
...
invoice.Scan.Modify(x => x = new byte[0]);
```
###Свойства типа - Xml
Для работы с Xml с использованием отложенного (lazy) связывания в XData предлагается использовать тип свойства *Xml*. Для этого типа определены следующие 

свойства:
	* XDocument *Document* - с помощью этого свойства можно получить и/или обновить значение XML
	* (readonly) bool *Assigned* - проверяет значение XML на значение NULL

методы:
	* *Extract*(string path, params KeyValuePair<string, string>[] namespaces) - возвращает результат XPath выражения *path* с использованием пространств имен *namespaces* (пара: псевдоним пространства имен - URL), в случае если БД поддерживает операции с XML выполнение XPath выражения производится на стороне БД.
	* (extension) *Modify*(Action<XDocument> action) - хелпер для удобства изменения значения XML

операции: 
	* += - "синтаксический сахар", _data.SomeXml += _someVariable идентично _data.SomeXml.Document = _someVariable.
	
Например:
```csharp
newInvoice.Source += new XDocument(new XElement("invoice", 
	new XAttribute("number", number), new XAttribute("state", newInvoice.DocStateCode)));
...
XDataManager.GetRepository<Invoice>(Owner, context: Context)
	.First(x => x.Source.Extract("(/invoice/@state)[1]") == "ACTIVE").DocNumb
...
invoice.Source.Modify(x => x = new XDocument());
```
###Свойства - ссылки на другие объекты
Для обеспечения возможности работы с внешними ссылками на объекты вне текущего бизнес объекта без оперирования сурогатными ключами (первичными (PK) и внешними (FK)), в XData предлагается использовать тип свойства *Link<TVal,TSrc>*, где *TVal* - тип свойства для просмотра, *TSrc* - тип ссылки на объект. Для этого типа определены следующие

свойства:
	* TVal *Value* - с помощью этого свойства можно получить значение для просмотра ссылки
	* TSrc *Source* - с помощью этого свойства можно установить текущее значение ссылки
	* (readonly) bool *Assigned* - проверяет значение XML на значение NULL

операции: 
	* += - "синтаксический сахар", _data.Source += _someDictionaryValue идентично _data.SomeXml.Source = _someDictionaryValue.
	
```csharp
newInvoice.DocState += XDataManager.GetDictionaryValue<DocState>(x => x.Code == "CREATED");
```
Для корректной работы свойств - ссылок необходимо определить на уровне описания отражения свойства, значения которых будут копироваться из объекта источника в свойства текущего объекта. Это описание различно для [статического](./static.md#Описание-ссылок) и [динамического](./dynamic.md#Описание-ссылок) способа описания объектного преобразования.

###Свойства только для чтения
Свойства только для чтения в XData предлагается оформлять как:
```csharp
public string DocStateCode { get { return this.GetProperty(x => x.DocStateCode); } }
```
В результате доступ к значению свойства будет обычным, значение свойства будет получено с помощью метода расширения *GetProperty*, а изменить его будет невозможно.

###Свойства для работы с подчиненными сущностями
Свойства для работы с наборами подчиненных объектов в XData предлагается оформлять как:
```csharp
public IRepository<InvoiceSpec> Spec { get { return this.GetRepository().GetChild<InvoiceSpec>(); } }
```
При этом дополнительное описание преобразования (кроме описания внешних связей) не требуется. Описание внешних связей объекта описывается различно для [статического](./static.md#Внешние-связи) и [динамического](./dynamic.md#Внешние-связи) методов описания преобразования. Свойства для работы с подчиненными сущностями являются необходимым условием использования реализации шаблона Unit Of Work в XData (см. [Частные случаи и советы - Обработка взаимосвязанных объектов](./tips_and_triks.md#Обработка-взаимосвязанных-объектов)).
