###Организация совместного доступа к данным
Совместный доступ к данным разрешается путем [пессимистической или оптимистической блокировки данных](https://ru.wikipedia.org/wiki/%D0%91%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0_(%D0%A1%D0%A3%D0%91%D0%94))) на уровне управления транзакциями. XData декларирует автоматическое управление транзакциями и поддержкой обоих видов блокировок при условии их поддержки на уровне СУБД.

Под поддержкой пессимистической блокировки здесь предполагается наличие на уровне СУБД механизма заблокировать одну запись одним потоком программы до момента окончания транзакции. В ситуации конкурретной гонки первый поток заблокирует данные, а остальные получат ошибку блокировки. Пессиместическая блокировка в XData запрашивается с помощью метода [*Lock*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/2/175.html) [репозитория](./glossary.md#Репозиторий), или метода расширения объекта предметной области ([*IDataObject*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/1/55.html)) [*Lock](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/2/113.html)). В случае отказа в блокировке данных (ошибка блокировки) ошибка будет погашена, но метод вернет **false**. Для работы пессимистической блокировки необходима транзакция. В случае отсутствия текущей транзакции вызывается искючение (exception).

Оптимистическая блокировка предполагает наличие в структуре таблицы БД специального поля - токена конкурренции который заполняется при вставке или изменении записи по некоторому алгоритму и проверяется на неизменность с момента запроса данных (можно конечно проверять все поля на полное соответствие исходным значениям, но это достаточно ресурсоемкая операция). В ситуации когда при обновлении (и удалении) данных идентифицируется факт изменения токена конкурренции система вызывает специальный тип исключения (в XData это [*XDataConcurrencyException*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/5/56.html)). Для описания токена конкурренции XData позволяет указать роль поля - токен конкурренции ([*ConcurrencyToken*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/1/305.html)) с помощью соответствующего [флага свойства](./glossary.md#Набор-флагов-свойства), и заполнять данные такого токена на основании одного из правил применения [значения по умолчанию](./glossary.md#Тип-значения-свойства-по-умолчанию). Проверка токена конкурренции производится для объектов имеющих поле с такой ролью автоматически. Имеется возможность принудительного указания флага игнорирования конкурренции [*IgnoreConcurrency*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/1/300.html) (именно при работе с оптимистической блокировкой) при применении изменений (при помощи метода репозитория [*Submit*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/2/181.html), или метода расширения объекта предметной области (*IDataObject*) [*Submit*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/2/120.html)). В этом случае проверка не производится и конкурренция разрешается в пользу последнего исправления.

>Поле токена конкурренции может быть скрытым, но не может не участвовать в результирующей выборке ([*Hidden*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/3/376.html)).

<!-- -->
>Для поля токена конкурренции должено быть описано правило применения значений по умолчанию и при этом должен быть выставлен флаг применения изменений при обновлении данных ([*AlwaysUseDefault*](https://htmlpreview.github.io/?https://raw.githubusercontent.com/mickfierte/XData/master/docs/doc/Contents/3/386.html) или сооветствующий флаг для правила генерации значения по умолчания для свойства).

Способы описания токена конкурренции при [статической](./static.md#Описание-преобразования-свойств) и [динамической](./dynamic.md#Описание-преобразования-свойств) модели описания различны и описаны в соответсвующих разделах. 
